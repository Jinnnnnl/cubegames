<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
    <title>å¯†å®¤é€ƒè„± - å…­é¢ä½“æˆ¿é—´</title>
    <link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
    <div class="game-container">
        <!-- æ¸¸æˆUI -->
        <div class="game-ui">
            <div class="progress-bar">
                <div class="progress-text">è¿›åº¦: <span id="progress">0/6</span></div>
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="controls">
                <button class="control-btn" onclick="rotateTo('front')">å‰</button>
                <button class="control-btn" onclick="rotateTo('back')">å</button>
                <button class="control-btn" onclick="rotateTo('left')">å·¦</button>
                <button class="control-btn" onclick="rotateTo('right')">å³</button>
                <button class="control-btn" onclick="rotateTo('top')">ä¸Š</button>
                <button class="control-btn" onclick="rotateTo('bottom')">ä¸‹</button>
            </div>
        </div>

        <!-- 3Dæˆ¿é—´å®¹å™¨ -->
        <div class="room-container">
            <div class="room" id="room">
                <!-- å‰å¢™ -->
                <div class="wall front-wall" data-wall="front">
                    <h3>å°ç¥æˆ˜åŠ›æ¦œå•ç›‘ç£ç®¡ç†æš‚è¡ŒåŠæ³•</h3>
                    <div class="puzzle-container" id="frontPuzzle">
                        <button class="solve-btn" onclick="loadPuzzle('front')">ğŸ“œ å¼€å¯å·å®—</button>
                        <div class="clue">ç‚¹å‡»å¼€å¯å·å®—ï¼Œä»”ç»†é˜…è¯»å¹¶å¡«å…¥æ­£ç¡®ç­”æ¡ˆ</div>
                    </div>
                </div>

                <!-- åå¢™ -->
                <div class="wall back-wall" data-wall="back">
                    <h3>æ³•å®äº‰å¤ºæˆ˜</h3>
                    <div class="puzzle-container" id="backPuzzle">
                        <button class="solve-btn" onclick="loadBackWall()" disabled>ğŸ”’ éœ€å…ˆå®Œæˆå‰å¢™</button>
                        <div class="clue">å€Ÿä½ ä¸€åŒæ…§çœ¼ï¼Œçœ‹æ¸…æ³•å®çœŸé¢ç›®~</div>
                    </div>
                </div>

                <!-- å·¦å¢™ -->
                <div class="wall left-wall" data-wall="left">
                    <h3>trinity Impossible</h3>
                    <div class="puzzle-container" id="leftPuzzle">
                        <button class="solve-btn" onclick="loadLeftWall()" disabled>ğŸ”’ éœ€å…ˆå®Œæˆå‰å¢™</button>
                        <div class="clue">ä¸å¯èƒ½ä¸‰è§’æŒ‘æˆ˜</div>
                    </div>
                </div>

                <!-- å³å¢™ -->
                <div class="wall right-wall" data-wall="right">
                    <h3>è¿·å®«æ¢ç§˜</h3>
                    <div class="puzzle-container" id="rightPuzzle">
                        <button class="solve-btn" onclick="loadPuzzle('right')" disabled>ğŸ”’ éœ€å…ˆå®Œæˆå‰å¢™</button>
                        <div class="clue">ä¸€ä¸ªå…³äºé€‰æ‹©ä¸å‘½è¿çš„è¿·å®«ã€‚</div>
                    </div>
                </div>

                <!-- ä¸Šå¢™ -->
                <div class="wall top-wall" data-wall="top">
                    <h3>çŒœçŒœæ˜¯å“ªå®¶</h3>
                    <div class="puzzle-container" id="topPuzzle">
                        <button class="solve-btn" onclick="loadPuzzle('top')" disabled>ğŸ”’ éœ€å…ˆå®Œæˆå‰å¢™</button>
                        <div class="clue">çŒœçŒœè¿™äº›å¡ç‰Œä»£è¡¨å“ªå®¶å…¬å¸</div>
                    </div>
                </div>

                <!-- ä¸‹å¢™ -->
                <div class="wall bottom-wall" data-wall="bottom">
                    <h3>å¦²å·±çš„å°¾å·´ï¼ŒæŠŠæ¡å¾—ä½å—ï¼Ÿ</h3>
                    <div class="puzzle-container" id="bottomPuzzle">
                        <button class="solve-btn" onclick="loadDownWall()" disabled>ğŸ”’ éœ€å…ˆå®Œæˆå‰å¢™</button>
                        <div class="clue">å¦²å·±çš„ä¹å°¾ä¸–ç•Œç­‰å¾…ç€ä½ çš„æŒ‘æˆ˜</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- è§£å¯†åŒºåŸŸ -->
        <div class="decryption-area">
            <p id="decryption-text">____________ is the key</p>
        </div>

        <!-- äºŒç»´ç å¼¹çª— -->
        <div id="qr-code-modal" class="qr-code-modal">
            <div class="qr-code-content">
                <span class="close-qr-btn">&times;</span>
                <img src="guess-company/assets/gm 2025-11-07.png" alt="WeChat QR Code">
            </div>
        </div>
        <!-- èƒœåˆ©å¼¹çª— -->
        <div class="victory-modal" id="victoryModal">
            <div class="modal-content">
                <h2>ğŸ‰ æ­å–œé€šå…³ï¼</h2>
                <p>ä½ æˆåŠŸé€ƒå‡ºäº†å¯†å®¤ï¼</p>
                <p>ç”¨æ—¶: <span id="gameTime"></span></p>
                <button onclick="restartGame()" class="solve-btn">é‡æ–°å¼€å§‹</button>
            </div>
        </div>
    </div>

        <!-- ç§»åŠ¨ç«¯æç¤º -->
        <div id="mobile-warning-overlay">
            <div id="mobile-warning-modal">
                <h2>æ¸©é¦¨æç¤º</h2>
                <p>æœ¬æ¸¸æˆæœªå¯¹ç§»åŠ¨è®¾å¤‡åšä¼˜åŒ–ï¼Œ<br>è¯·åœ¨ç”µè„‘ç½‘é¡µä¸Šè¿›è¡Œæµ‹è¯•ã€‚</p>
                <button id="mobile-warning-close-btn" class="solve-btn" onclick="document.getElementById('mobile-warning-overlay').style.display='none'">æˆ‘æ˜ç™½äº†</button>
            </div>
        </div>

    <script src=\"assets/js/main.js\"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const correctKey = 'transparency';
            const input = document.createElement('input');
            input.id = 'decryption-input';
            input.type = 'text';
            input.maxLength = 12;
            input.autocomplete = 'off';
            input.autocapitalize = 'off';
            input.spellcheck = false;
            input.style.position = 'absolute';
            input.style.left = '-9999px';
            document.body.appendChild(input);

            function getTyped() { return (input.value || '').toLowerCase(); }

            input.addEventListener('input', function() {
                const typedKey = getTyped();
                updateDecryptionText(typedKey);
                if (typedKey === correctKey) {
                    showQrCode();
                    input.value = '';
                    updateDecryptionText('');
                }
            });

            // allow focusing the hidden input when clicking the decryption area
            const decryptionArea = document.querySelector('.decryption-area');
            if (decryptionArea) {
                decryptionArea.addEventListener('click', function() { input.focus(); });
            }

            // initialize display
            updateDecryptionText('');

            function updateDecryptionText(typedKey) {
                typedKey = typedKey || '';
                // ä»å·¦åˆ°å³æ˜¾ç¤ºå·²è¾“å…¥çš„å­—æ¯ï¼Œæœªè¾“å…¥éƒ¨åˆ†æ˜¾ç¤ºä¸‹åˆ’çº¿
                const display = typedKey + '_'.repeat(12 - typedKey.length);
                document.getElementById('decryption-text').textContent = display + ' is the key';
            }

            function showQrCode() {
                const modal = document.getElementById('qr-code-modal');
                modal.style.display = 'flex';
            }

            const closeBtn = document.querySelector('.close-qr-btn');
            if(closeBtn) {
                closeBtn.onclick = function() {
                    const modal = document.getElementById('qr-code-modal');
                    modal.style.display = 'none';
                }
            }

            window.onclick = function(event) {
                const modal = document.getElementById('qr-code-modal');
                if (event.target == modal) {
                    modal.style.display = 'none';
                }
            }

            // focus on load so users can type immediately
            input.focus();
        });
    </script>
    <script>
        // ç¡®ä¿å‡½æ•°åœ¨é¡µé¢åŠ è½½åç«‹å³å¯ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, binding functions...');
            
            // ç›´æ¥å®šä¹‰rotateToå‡½æ•°
            window.rotateTo = function(wall) {
                console.log('rotateTo called with:', wall);
                const room = document.getElementById('room');
                if (!room) {
                    console.error('Room element not found');
                    return;
                }
                
                const rotations = {
                    front: 'rotateX(0deg) rotateY(0deg)',
                    back: 'rotateX(0deg) rotateY(180deg)',
                    left: 'rotateX(0deg) rotateY(90deg)',
                    right: 'rotateX(0deg) rotateY(-90deg)',
                    top: 'rotateX(-90deg) rotateY(0deg)',
                    bottom: 'rotateX(90deg) rotateY(0deg)'
                };
                
                room.style.transform = rotations[wall];
                console.log('Applied transform:', rotations[wall]);
            };
            
            // ç›´æ¥å®šä¹‰loadPuzzleå‡½æ•°
            window.loadPuzzle = function(wall) {
                console.log('loadPuzzle called with:', wall);
                
                switch(wall) {
                    case 'front':
                        loadFrontWall();
                        break;
                    case 'back':
                        window.open('games/back-wall.html', '_blank');
                        break;
                    case 'left':
                        window.open('games/left-wall.html', '_blank');
                        break;
                    case 'right':
                        window.open('games/right-wall.html', '_blank');
                        break;
                    case 'top':
                        console.log('Navigating to guess-company game...');
                        window.location.href = 'games/guess-company.html';
                        break;
                    case 'bottom':
                    case 'down':
                        window.open('games/down-wall.html', '_blank');
                        break;
                    default:
                        alert('åŠ è½½ ' + wall + ' å¢™è°œé¢˜');
                }
            };
            
            // å„ä¸ªå¢™é¢çš„ä¸“é—¨åŠ è½½å‡½æ•°
            window.loadBackWall = function() {
                console.log('loadBackWall called');
                window.open('games/back-wall.html', '_blank');
            };
            
            window.loadLeftWall = function() {
                console.log('loadLeftWall called');
                window.open('games/left-wall.html', '_blank');
            };
            

            window.loadTopWall = function() {
                console.log('loadTopWall called');
                window.open('games/guess-company.html', '_blank');
            };
            
            window.loadDownWall = function() {
                console.log('loadDownWall called');
                window.open('games/down-wall.html', '_blank');
            };
            
            // å‰å¢™è°œé¢˜åŠ è½½å‡½æ•°
            function loadFrontWall() {
                console.log('Loading front wall puzzle...');
                
                // åŠ¨æ€åŠ è½½å°ç¥å·å®—è°œé¢˜
                const script = document.createElement('script');
                script.src = 'puzzles/front-puzzle.js';
                script.onload = () => {
                    console.log('Front puzzle script loaded');
                    if (window.initFrontPuzzle) {
                        window.initFrontPuzzle();
                    } else {
                        console.error('initFrontPuzzle function not found');
                    }
                };
                script.onerror = () => {
                    console.error('Failed to load front puzzle script');
                    alert('åŠ è½½å°ç¥å·å®—å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶è·¯å¾„');
                };
                document.head.appendChild(script);
                
                // åŠ è½½å¯¹åº”çš„CSSæ–‡ä»¶
                const link = document.createElement('link');
                link.rel = 'stylesheet';
                link.href = 'puzzles/front-puzzle.css';
                link.onerror = () => {
                    console.error('Failed to load front puzzle CSS');
                };
                document.head.appendChild(link);
            }
            
            // æ ‡è®°å¢™é¢å®ŒæˆçŠ¶æ€çš„å‡½æ•°
            window.markWallCompleted = function(wallName) {
                console.log('Marking wall completed:', wallName);
                localStorage.setItem(wallName + 'WallCompleted', 'true');
                updateWallStatus(wallName);
            };
            
            // æ›´æ–°å¢™é¢çŠ¶æ€æ˜¾ç¤º
            function updateWallStatus(wallName) {
                const wallElement = document.querySelector(`[data-wall="${wallName}"]`);
                if (wallElement) {
                    wallElement.classList.add('solved');
                    const button = wallElement.querySelector('.solve-btn');
                    const clue = wallElement.querySelector('.clue');
                    if (button && clue) {
                        button.innerHTML = 'âœ… å·²å®Œæˆ';
                        button.disabled = true;
                        clue.innerHTML = 'æ­å–œï¼ä½ å·²ç»å®Œæˆäº†è¿™ä¸ªæŒ‘æˆ˜ï¼';
                    }
                }
            }
            
            // æ£€æŸ¥æ‰€æœ‰å¢™é¢çš„å®ŒæˆçŠ¶æ€
            function checkWallCompletionStatus() {
                const walls = ['front', 'back', 'left', 'right', 'top', 'bottom'];
                walls.forEach(wall => {
                    if (localStorage.getItem(wall + 'WallCompleted') === 'true') {
                        updateWallStatus(wall);
                    }
                });
            }
            
            // é¡µé¢åŠ è½½æ—¶æ£€æŸ¥å®ŒæˆçŠ¶æ€
            checkWallCompletionStatus();
            
            console.log('Functions bound successfully');
        });
    </script>
</body>
</html>